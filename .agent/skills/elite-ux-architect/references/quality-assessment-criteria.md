# 品質評価基準 — 実装・パフォーマンス・アクセシビリティ

このドキュメントは、UIの実装品質を評価するための包括的な基準を定義する。
すべてのUI作成・改善時にこの基準を参照し、クリアしていることを確認する。

---

## 1. コード品質

### TypeScript 基準

| 基準 | 必須/推奨 | 説明 |
|------|----------|------|
| strict モード | 必須 | `tsconfig.json` の `strict: true` を前提とする |
| `any` 排除 | 必須 | `any` の使用は原則禁止。やむを得ない場合はコメントで理由を記述 |
| 型推論の活用 | 推奨 | 自明な型は省略し、複雑な型のみ明示する |
| Union/Discriminated Union | 推奨 | 状態の分岐は判別可能な Union 型で型安全にする |
| ジェネリクス | 推奨 | 再利用可能なコンポーネント・関数にはジェネリクスを活用 |

### React コンポーネント基準

| 基準 | 必須/推奨 | 説明 |
|------|----------|------|
| 関数コンポーネント | 必須 | クラスコンポーネントは使用しない |
| 単一責任原則 | 必須 | 1コンポーネント1責務。200行を超えたら分割を検討 |
| Props の型定義 | 必須 | `interface` で明確に定義する |
| デフォルトエクスポート回避 | 推奨 | Named export を優先する |
| カスタムフック分離 | 推奨 | ロジックはカスタムフックに分離する |
| メモ化 | 条件付き | 重い計算・頻繁な再レンダリングがある場合のみ適用 |

### 命名規約

| 対象 | 規約 | 例 |
|------|------|-----|
| コンポーネント | PascalCase | `PreviewSection`, `ClipItem` |
| フック | camelCase + `use` prefix | `usePlayback`, `useMediaItems` |
| 定数 | SCREAMING_SNAKE_CASE | `MAX_CLIP_COUNT`, `DEFAULT_VOLUME` |
| 関数 | camelCase + 動詞 prefix | `handleClick`, `formatTime`, `loadMedia` |
| 型/Interface | PascalCase | `MediaItem`, `PlaybackState` |
| ストア | camelCase + `Store` suffix | `mediaStore`, `uiStore` |

---

## 2. パフォーマンス基準

### レンダリング

| 基準 | 目標 | 計測方法 |
|------|------|---------|
| 不要な再レンダリング | 0回 | React DevTools Profiler |
| リスト描画 | < 16ms/frame | `key` prop の適切な設定 + 仮想化（大量アイテム時） |
| 初回描画 | < 100ms | コード分割 + 遅延ロード |
| アニメーション | 60fps | `transform` + `opacity` のみ使用 |

### メモリ

| 基準 | 注意点 |
|------|--------|
| イベントリスナー | コンポーネント unmount 時に必ず解除する |
| タイマー | `setInterval` / `setTimeout` は cleanup で解除する |
| メディアリソース | `URL.revokeObjectURL()` で確実に解放する |
| 大量データ | 無限スクロールや仮想化を検討する |

### バンドルサイズ

| 基準 | 方針 |
|------|------|
| Tree Shaking | Named import でバンドルサイズを最小化する |
| 動的 import | 重いコンポーネントは `React.lazy()` で遅延ロードする |
| 外部ライブラリ | 追加する場合はバンドルサイズへの影響を確認する |

---

## 3. アクセシビリティ基準（WCAG 2.1 AA準拠）

### 知覚可能

| 基準 | 要件 |
|------|------|
| テキストコントラスト | 通常テキスト: 4.5:1以上、大テキスト: 3:1以上 |
| 非テキストコントラスト | UI要素・グラフィック: 3:1以上 |
| 色だけに依存しない | 色+形状 or 色+テキストで情報を伝える |
| 動画メディア | 字幕・代替テキストの提供 |

### 操作可能

| 基準 | 要件 |
|------|------|
| キーボードナビゲーション | `Tab` / `Shift+Tab` / `Enter` / `Space` / `Escape` / `Arrow` |
| フォーカス順序 | DOM順序が論理的で、視覚的順序と一致する |
| フォーカスインジケータ | `:focus-visible` で明確なフォーカスリングを表示する |
| タッチターゲット | 最小 44x44px |
| ドラッグ操作 | ドラッグ不要な代替手段を提供する |

### 理解可能

| 基準 | 要件 |
|------|------|
| エラーメッセージ | 問題と解決策を具体的に伝える |
| ラベル | すべてのフォーム要素にラベルを付ける |
| 一貫性 | 同じ機能は同じ方法で操作できる |

### 堅牢

| 基準 | 要件 |
|------|------|
| セマンティックHTML | `<button>`, `<nav>`, `<main>`, `<section>` 等を適切に使う |
| ARIA | ネイティブ要素で不足する場合のみ使用する |
| ライブリージョン | 動的な更新は `aria-live` で通知する |

---

## 4. セキュリティ基準

| 基準 | 要件 |
|------|------|
| XSS防止 | ユーザー入力のサニタイズ。`dangerouslySetInnerHTML` は原則禁止 |
| 外部リンク | `rel="noopener noreferrer"` を付与する |
| 依存ライブラリ | 既知の脆弱性がないことを確認する |

---

## 5. UI品質チェックリスト

### Create モード — 新規作成時

新規UIの作成が完了したら、以下をすべて確認する：

#### ビジュアル品質
- [ ] カラーパレットがプロジェクトのデザイントークンに準拠している
- [ ] タイポグラフィスケールが一貫している
- [ ] 余白のリズムが規則的で、視覚的ヒエラルキーが明確
- [ ] 角丸・シャドウの使い方が既存UIと統一されている
- [ ] ダークモード/ライトモードの両方で正常に表示される

#### インタラクション品質
- [ ] すべての操作に即時のフィードバックがある
- [ ] アニメーションが自然で、パフォーマンスに影響しない
- [ ] ホバー・フォーカス・アクティブ・無効の全状態が定義されている
- [ ] エラー状態のUIが用意されている
- [ ] 空状態のUIが用意されている
- [ ] ローディング状態のUIが用意されている

#### 技術品質
- [ ] TypeScript のエラーがゼロ
- [ ] `any` を使用していない
- [ ] 不要な再レンダリングがない
- [ ] メモリリークの要因がない
- [ ] キーボードのみで全操作が可能
- [ ] スクリーンリーダーで内容が理解できる

#### Wow Factor
- [ ] 初見で感動を与えるデザインか
- [ ] 細部まで丁寧に作り込まれているか
- [ ] 不要な要素がなく、洗練されているか

### Enhance モード — 改善時

既存UIの改善が完了したら、以下を確認する：

- [ ] 既存の操作フローを壊していない
- [ ] 既存のテストが通る
- [ ] 変更箇所が最小限にとどめられている
- [ ] 改善によってパフォーマンスが悪化していない
- [ ] アクセシビリティが維持または向上している
- [ ] ビフォー/アフターの差分が明確

---

## 6. 総合評価スコアリング

各UIを以下の5軸で評価する（各10点満点、合計50点）：

| 評価軸 | 10点 | 7-8点 | 4-6点 | 1-3点 |
|--------|------|-------|-------|-------|
| **ビジュアル** | 息を呑む美しさ | 十分に美しい | 普通 | 雑・不統一 |
| **操作性** | 説明不要で完璧 | スムーズ | たまに迷う | 頻繁に迷う |
| **パフォーマンス** | 瞬時・完璧 | 問題なし | やや重い | 遅い・引っかかる |
| **アクセシビリティ** | AAA準拠 | AA準拠 | 一部対応 | 未対応 |
| **コード品質** | 教科書レベル | 十分に良い | 改善の余地あり | 保守困難 |

**目標スコア**:
- Create モード: **45点以上**（平均9点/軸）
- Enhance モード: 改善前のスコアから **+5点以上** の向上
